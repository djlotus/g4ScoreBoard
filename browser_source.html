<!doctype html>
<!-- 
G4ScoreBoard addon for OBS version 1.6.0 Copyright 2022 Norman Gholson IV
https://g4billiards.com http://www.g4creations.com

this is a purely javascript/html/css driven scoreboard system for OBS Studio

free to use and modify and use as long as this copyright statment remains intact. 

Salotto logo is the copyright of Salotto and is used with their permission.
for more information about Salotto please visit https://salotto.app

-->

<html>
    <head>
      	 <script src="./common/js/jquery.js"></script>

		<link rel="stylesheet" href="100.css" />
		<link rel="stylesheet" href="125.css" />
		<link rel="stylesheet" href="150.css" />
		
    </head>
    <body>
		<div class="noShow fadeInElm" id="raceInfo">&nbsp;</div><div class="noShow fadeInElm" id="wagerInfo">&nbsp;</div>

        <div id="scoreBoardDiv"  class="fadeInElm">
		<div class="shotclockvis fadeOutElm" id="shotClockVis"></div>
        <img class="fadeOutElm" id="salottoLogo" height="20px" src="./images/salotto.png">
        <img class="fadeOutElm" id="g4Logo" height="20px" src="./images/logo.png">

        <div class="fadeInElm" id="p1ExtIcon">Ex</div>            
        <div class="fadeInElm" id="p2ExtIcon">Ex</div>            
        <table id="scoreBoard">
             <tr>
                <td class="noShow"></td>
                <td class="fadeOutElm" colspan="2" id="shotClock">&nbsp;</td>
                <td class="noShow"></td>
            </tr>
			
            <tr>
                <td id="player1Name">Player 1</td>
                <td id="player1Score">0</td>
                <td id="player2Score">0</td>
                <td id="player2Name">Player 2</td>
            </tr>
           
        </table>
<!-- testing -->
		<div id="logoSlideshowDiv" class="slideshow-container fadeOutElm">
		<div class="mySlides logoSlide fade">
		<img id="customLogo1" src="" style="height:20px">
 		</div>
		<div class="mySlides logoSlide fade">
		<img id="customLogo2" src="" style="height:20px">
		</div>
		<div class="mySlides logoSlide fade">
		<img  id="customLogo3" src="" style="height:20px">
		</div>
		</div>
 <!--testing  -->       
		</div>
        <script>
		if (localStorage.getItem("b_style") != null) {
			styleChange(localStorage.getItem("b_style"));
			}else{
				document.styleSheets[0].disabled = true;
				document.styleSheets[1].disabled = false;
				document.styleSheets[2].disabled = true;
			}
				
		function styleChange(n) {
			if (n == 1) {
			document.styleSheets[0].disabled = false;
			document.styleSheets[1].disabled = true;
			document.styleSheets[2].disabled = true;
			}
			if (n == 2) {
			document.styleSheets[0].disabled = true;
			document.styleSheets[1].disabled = false;
			document.styleSheets[2].disabled = true;
			}
			if (n == 3) {
			document.styleSheets[0].disabled = true;
			document.styleSheets[1].disabled = true;
			document.styleSheets[2].disabled = false;
			}
			
		}


		
		if (localStorage.getItem("customLogo1") != null) {
		document.getElementById("customLogo1").src = localStorage.getItem("customLogo1");
		document.getElementById("customLogo2").src = localStorage.getItem("customLogo2");
		document.getElementById("customLogo3").src = localStorage.getItem("customLogo3");
		}
		
		let slideIndex = 0;
		showSlides();
		
		function showSlides() {
		  let i;
		  let slides = document.getElementsByClassName("logoSlide");
		   for (i = 0; i < slides.length; i++) {
			slides[i].style.display = "none";  
		  }
		  slideIndex++;
		  if (slideIndex > slides.length) {slideIndex = 1}    
		   slides[slideIndex-1].style.display = "block";  
		   setTimeout(showSlides, 20000); // Change image every 20 seconds
		}

		
		
		
		
			if (localStorage.getItem("customImage") !== null) {
				document.getElementById("g4Logo").src = localStorage.getItem("customImage");
			}
			
			if  (localStorage.getItem("p1ScoreCtrlPanel") !== null) {
			document.getElementById("player1Score").innerHTML = localStorage.getItem("p1ScoreCtrlPanel");
			} else {
			document.getElementById("player1Score").innerHTML = 0;
			}

			if  (localStorage.getItem("p2ScoreCtrlPanel") !== null) {
			document.getElementById("player2Score").innerHTML = localStorage.getItem("p2ScoreCtrlPanel");
			} else {
			document.getElementById("player2Score").innerHTML = 0;
			}

			if (localStorage.getItem("wagerInfo") !== ""){
				document.getElementById("wagerInfo").classList.remove("noShow");
				}
			
			if (localStorage.getItem("raceInfo") !== ""){
				document.getElementById("raceInfo").classList.remove("noShow");
				}
				
			document.getElementById("player1Name").innerHTML = localStorage.getItem("p1NameCtrlPanel");
			document.getElementById("raceInfo").innerHTML = localStorage.getItem("raceInfo");
			document.getElementById("player2Name").innerHTML = localStorage.getItem("p2NameCtrlPanel");			
			document.getElementById("wagerInfo").innerHTML = localStorage.getItem("wagerInfo");			
			document.getElementById("raceInfo").innerHTML = localStorage.getItem("raceInfo");			

			
			if (localStorage.getItem("useCustomLogo") == "yes") {
				document.getElementById("g4Logo").classList.replace("fadeOutElm","fadeInElm");			
			}
			if (localStorage.getItem("useSalotto") == "yes") {
				document.getElementById("salottoLogo").classList.replace("fadeOutElm","fadeInElm");		
			}
			if (localStorage.getItem("useClock") !== "yes") {
				document.getElementById("p1ExtIcon").classList.replace("fadeInElm","fadeOutElm");	
				document.getElementById("p2ExtIcon").classList.replace("fadeInElm","fadeOutElm");			
			}
			
			if (localStorage.getItem('p1colorSet') !== "") {
				document.getElementById("player1Name").style.background = "linear-gradient(to left, white , "+localStorage.getItem('p1colorSet');
				console.log("p1color: "+localStorage.getItem('p1colorSet'));
			}
			if (localStorage.getItem('p2colorSet') !== "") {
				document.getElementById("player2Name").style.background = "linear-gradient(to right, white , "+localStorage.getItem('p2colorSet');
				console.log("p2color: "+localStorage.getItem('p2colorSet'));
			}
			
			
			
            var countDownTime;
            var shotClockxr = null;
            const bcp1s = new BroadcastChannel('player1Score');  // i know there is a better way to do all of this but i don't know how yet....
            const bcp2s = new BroadcastChannel('player2Score');
            const bcp1n = new BroadcastChannel('player1Name');
            const bcp2n = new BroadcastChannel('player2Name');
			const bcShotClockStart = new BroadcastChannel('shotClockStart');
			const bcClockDisplay = new BroadcastChannel('clockDisplay');
			const bcri = new BroadcastChannel('race');
			const bcw = new BroadcastChannel('wager');
			const bcp1c = new BroadcastChannel('p1_color');
			const bcp2c = new BroadcastChannel('p2_color');
			const bcr = new BroadcastChannel('recv'); // browser_source -> control_panel channel 
			const bco = new BroadcastChannel('sbopacity');
			
			bco.onmessage = (event) => {
				document.getElementById("scoreBoardDiv").style.opacity  = event.data;
				document.getElementById("raceInfo").style.opacity  = event.data;
				document.getElementById("wagerInfo").style.opacity  = event.data;
			}

			bcClockDisplay.onmessage = (event) => {
				console.log("event.data: " + event.data);
				if (event.data == "show"){
					showClock();
					}  

				if (event.data == "hide") {
						hideClock();
					}  

				if (event.data == "stopClock") {
						stopClock();
					}  

				if (event.data == "noClock") {
						document.getElementById("p1ExtIcon").classList.replace("fadeInElm","fadeOutElm");	
						document.getElementById("p2ExtIcon").classList.replace("fadeInElm","fadeOutElm");	
					}  

				if (event.data == "useClock") {
						document.getElementById("p1ExtIcon").classList.replace("fadeOutElm","fadeInElm");	
						document.getElementById("p2ExtIcon").classList.replace("fadeOutElm","fadeInElm");	
					} 

				if (event.data == "p1extension") {
						add30(1);
					} 

				if (event.data == "p2extension") {
						add30(2);
					} 

				if (event.data == "p1ExtReset") {
						extReset('p1');
					} 

				if (event.data =="p2ExtReset") {
						extReset('p2');
					}  

				if (event.data =="hidesalotto") {
						salottoHide();
					}  

				if (event.data =="showsalotto") {
						salottoShow();
					}
					
				if (event.data =="hidecustomLogo") {
						customHide();
					} 
					
				if (event.data =="showcustomLogo") {
						customShow();
					}
					
				if (event.data =="postLogo") {
						postLogo();
					}
				if (event.data  =="logoSlideShow-show")  {
					customHide(); 
					
					document.getElementById("logoSlideshowDiv").classList.replace("fadeOutElm", "fadeInElm");
					document.getElementById("g4Logo").classList.replace("fadeOutElm", "logoSlide");
					document.getElementById("g4Logo").classList.add("fade");
					if (localStorage.getItem("customLogo1") != null) {document.getElementById("customLogo1").src = localStorage.getItem("customLogo1");} else { document.getElementById("customLogo1").src = "./images/placeholder.png"; };
					if (localStorage.getItem("customLogo2") != null) {document.getElementById("customLogo2").src = localStorage.getItem("customLogo2");} else { document.getElementById("customLogo2").src = "./images/placeholder.png"; };
					if (localStorage.getItem("customLogo3") != null) {document.getElementById("customLogo3").src = localStorage.getItem("customLogo3");} else { document.getElementById("customLogo3").src = "./images/placeholder.png"; };
					
					}
				if (event.data =="logoSlideShow-hide") {
					document.getElementById("logoSlideshowDiv").classList.replace("fadeInElm", "fadeOutElm");
					}
				if (event.data =="style100") {
					styleChange(1);
					}
				if (event.data =="style125") {
					styleChange(2);
					}	
				if (event.data =="style150") {
					styleChange(3);
					}
			}
			
			bcp1c.onmessage = (event) => {
				console.log("event.data: " + event.data);			
				document.getElementById("player1Name").style.background = "linear-gradient(to left, white , "+event.data;
			}
			
			bcp2c.onmessage = (event) => {
				console.log("event.data: " + event.data);
				document.getElementById("player2Name").style.background = "linear-gradient(to right, white , "+event.data;
			}
			
			
			bcri.onmessage = (event) => {
			console.log("event.data: " + event.data);
			if (event.data == "") {
					document.getElementById("raceInfo").classList.add("noShow");
					document.getElementById("raceInfo").classList.remove("fadeInElm");

					} else {
						document.getElementById("raceInfo").classList.remove("noShow");
						document.getElementById("raceInfo").classList.add("fadeInElm");
						document.getElementById("raceInfo").innerHTML = event.data;
				}
			}
			bcw.onmessage = (event) => {
			console.log("event.data: " + event.data);
				if (event.data == "") {
					document.getElementById("wagerInfo").classList.add("noShow");
					document.getElementById("wagerInfo").classList.remove("fadeInElm");
					} else {
						document.getElementById("wagerInfo").classList.remove("noShow");
						document.getElementById("wagerInfo").classList.add("fadeInElm");

						document.getElementById("wagerInfo").innerHTML = event.data;
				}
			}
			
			bcShotClockStart.onmessage = (event) => {
				console.log("event.data: " + event.data);
				shotTimer(event.data);
			}
			
           bcp1s.onmessage = (event) => { 
		   		console.log("event.data: " + event.data);
				if (!event.data == 0) {
               document.getElementById("player1Score").innerHTML = event.data;
               document.getElementById("player1Score").classList.add("winBlink");
			   
               setTimeout("clearWinBlink()",1000);
				} else {
				document.getElementById("player1Score").innerHTML = event.data;
				
				}

               
               
            }
            
			bcp2s.onmessage = (event) => { 
				console.log("event.data: " + event.data);
				if (!event.data == 0) {
               document.getElementById("player2Score").innerHTML = event.data;
               document.getElementById("player2Score").classList.add("winBlink");
			   
               setTimeout("clearWinBlink()",1000);
			   } else {
			   document.getElementById("player2Score").innerHTML = event.data;
			
			   }
               
            }
            
			bcp1n.onmessage = (event) => { 
				console.log("event.data: " + event.data);
				if (!event.data == ""){
					document.getElementById("player1Name").innerHTML = event.data;
					
					
						} else {
							document.getElementById("player1Name").innerHTML = "Player 1";
						}
            }
		   
            bcp2n.onmessage = (event) => { 
				console.log("event.data: " + event.data);
               if (!event.data == ""){
					document.getElementById("player2Name").innerHTML = event.data;
						} else {
							document.getElementById("player2Name").innerHTML = "Player 2";
						}
               
               
           }
		   
		    function postLogo() {
			if (localStorage.getItem("customImage") !== "") {
				document.getElementById("g4Logo").src = localStorage.getItem("customImage");
			
			}
			}
			function clearWinBlink() {
                document.getElementById("player1Score").classList.remove("winBlink");
                document.getElementById("player2Score").classList.remove("winBlink");
            }
			
			 function shotTimer(shottime){
                var tev;
			    countDownTime = new Date().getTime() + shottime;
                shotClockxr = setInterval(function() {
                var now = new Date().getTime();
                var distance = countDownTime - now;
                var seconds = Math.floor((distance % (1000 * 60)) / 1000);
				document.getElementById("shotClockVis").classList.replace("fadeOutElm","fadeInElm");
               	document.getElementById("shotClockVis").style.background = "lime";
                document.getElementById("shotClock").style.background = "green";
				if (distance > 21000){
		                document.getElementById("shotClock").style.color = "white";
					}
				if (distance > 5000 && distance < 21000) {
	                document.getElementById("shotClock").style.color = "black";
					}
					
				if (shottime == 61000) {
					document.getElementById("shotClockVis").classList.add("start60");
					} else {
					document.getElementById("shotClockVis").classList.add("startTimer");
					}
										
				if (distance > 60000) {
                      seconds = seconds + 60;
                    } 
                    document.getElementById("shotClock").innerHTML = seconds + "s";
                    
					if (distance < 31000) {
						document.getElementById("shotClockVis").classList.replace("fadeOutElm","fadeInElm");
                    	document.getElementById("shotClockVis").style.background = "lime";
						document.getElementById("shotClockVis").classList.add("startTimer");

						}
					if (distance < 26000) {
                    	document.getElementById("shotClockVis").style.background = "#5aa500";
						document.getElementById("shotClockVis").style.opacity = "0.7";
                        }
                        
					if (distance < 21000) {
                    	document.getElementById("shotClockVis").style.background = "#639b00";
                        document.getElementById("shotClock").style.background = "orange";

                        }
                    if (distance < 16000) {

                        document.getElementById("shotClock").style.background = "yellow";
						document.getElementById("shotClockVis").style.background = "#926d00";

                    }

                    if (distance < 11000) {
                        document.getElementById("shotClock").style.background = "tomato";
						document.getElementById("shotClockVis").style.background = "#d12f00";
						document.getElementById("shotClockVis").style.opacity = "1";          
					}
					if (distance < 11000 && distance > 9700) {	
					   showClock();
					}
                    
                    if (distance < 6000 && distance > 999) {
                        document.getElementById("shotClock").classList.add("shotRed");
                        document.getElementById("shotClock").style.background = "red";
						document.getElementById("shotClockVis").style.background = "red";
						document.getElementById("shotClock").style.color = "white";

                    }
                    if (distance < 1000) {
                        clearInterval(shotClockxr);
                        document.getElementById("shotClock").style.background = "red";
						document.getElementById("shotClockVis").style.background = "red";
						document.getElementById("shotClock").style.color = "white";
                    

                    }
					if (seconds == tev) {
						var ntev = seconds --- 1;
						document.getElementById("shotClock").innerHTML = ntev + "s";
						tev = ntev;
						console.log("dup Detected- tev:"+tev);
						bcr.postMessage(tev);
						} else {
							document.getElementById("shotClock").innerHTML = seconds + "s";
							tev = seconds;
							console.log("tev:"+tev);
							bcr.postMessage(tev);
						}
						
                 }, 1000);
                
				}


			 function showClock(){
                document.getElementById("shotClock").classList.replace("fadeOutElm","fadeInElm");
            }

            function hideClock(){
                document.getElementById("shotClock").classList.replace("fadeInElm", "fadeOutElm");
            }
			
			function stopClock() {
                clearInterval(shotClockxr);
				hideClock();
				document.getElementById("shotClock").innerHTML = "&nbsp;";
				document.getElementById("shotClock").classList.remove("shotRed");
                document.getElementById("shotClock").style.background = "";
                document.getElementById("shotClockVis").classList.replace("fadeInElm", "fadeOutElm");
				document.getElementById("shotClockVis").classList.remove("startTimer");
				document.getElementById("shotClockVis").classList.remove("start60");
				document.getElementById("shotClockVis").style.background = "";

			}
			var playerNumber;
			function add30(player) { 
					countDownTime = countDownTime + 30000;
					document.getElementById("p"+player+"ExtIcon").style.background = "darkred";
                    document.getElementById("shotClock").classList.remove("shotRed");
                    document.getElementById("shotClock").style.background = "";    
					document.getElementById("shotClockVis").classList.remove("startTimer");
					document.getElementById("shotClockVis").classList.remove("start60");
					document.getElementById("shotClockVis").style.background = "";
					document.getElementById("shotClock").classList.replace("fadeInElm", "fadeOutElm");
					document.getElementById("shotClockVis").classList.replace("fadeInElm", "fadeOutElm");
					document.getElementById("p"+player+"ExtIcon").classList.add("extBlink");
					playerNumber =  player;
					setTimeout("clearExtBlink(playerNumber)",500);	
			}
			
			function clearExtBlink(playerN) {
                document.getElementById("p"+playerN+"ExtIcon").classList.remove("extBlink");
                document.getElementById("p"+playerN+"ExtIcon").style.background = "darkred";

			}
			
			function extReset(player) {
			    document.getElementById(player+"ExtIcon").style.background = "green";
                             
				}
				
			function salottoShow() {
				document.getElementById("salottoLogo").classList.replace("fadeOutElm","fadeInElm");	
			
			}
			function salottoHide() {
				document.getElementById("salottoLogo").classList.replace("fadeInElm","fadeOutElm");
			
			}
			
			function customShow() {
				if (document.getElementById("g4Logo").classList.contains("logoSlide")) {
					document.getElementById("g4Logo").classList.replace("logoSlide", "fadeOutElm"); }
				if (document.getElementById("g4Logo").classList.contains("fade")) {
					document.getElementById("g4Logo").classList.remove("fade"); }
				document.getElementById("g4Logo").style.display = "block";
				document.getElementById("g4Logo").classList.replace("fadeOutElm","fadeInElm");
			
			}
			function customHide() {
				document.getElementById("g4Logo").classList.replace("fadeInElm","fadeOutElm");
				document.getElementById("g4Logo").style.display = "none";
			
			}
					if (localStorage.getItem("customLogo1") != null) {document.getElementById("customLogo1").src = localStorage.getItem("customLogo1");} else { document.getElementById("customLogo1").src = "./images/placeholder.png"; };
					if (localStorage.getItem("customLogo2") != null) {document.getElementById("customLogo2").src = localStorage.getItem("customLogo2");} else { document.getElementById("customLogo2").src = "./images/placeholder.png"; };
					if (localStorage.getItem("customLogo3") != null) {document.getElementById("customLogo3").src = localStorage.getItem("customLogo3");} else { document.getElementById("customLogo3").src = "./images/placeholder.png"; };
					
			if (localStorage.getItem("slideShow")  == "yes") { 
				document.getElementById("logoSlideshowDiv").classList.replace("fadeOutElm", "fadeInElm");
				document.getElementById("logoSlideshowDiv").classList.replace("fadeOutElm", "fadeInElm");
				document.getElementById("g4Logo").classList.replace("fadeOutElm", "logoSlide");
				document.getElementById("g4Logo").classList.add("fade");
				}
				
        </script>
    </body>
</html>