
<!-- 
G4ScoreBoard addon for OBS version 1.6.0 Copyright 2022 Norman Gholson IV
https://g4billiards.com http://www.g4creations.com
this is a purely javascript/html/css driven scoreboard system for OBS Studio
free to use and modify and use as long as this copyright statment remains intact. 
Salotto logo is the copyright of Salotto and is used with their permission.
for more information about Salotto please visit https://salotto.app
-->

<html>
    <head>
	 <script src="./common/js/jquery.js"></script>
	 <script src="hotkeys.js"></script>
     <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
	 <script>
	 //---------------------------------------------------------------------------------------------
	 var versionNum = "1.6.0-daily.220905-1";
 	 var cLogoName = "G4";  // 6 character limit. it will auto trim to 6 characters.
	 //---------------------------------------------------------------------------------------------
	 </script>
	 
    <style>
	.obs28 {
		background: #3c404b;
		border:0px;
	}
		
	body{
		font-family:tahoma;
		background:#2b2e38;
		margin-left:auto;
		margin-right:auto;
		margin-bottom:auto;
		margin-top:1px;
		}
	span {
		cursor: default;
		color:lightgrey;
		font-size:8pt;
		}
	div {
		background:#4c4c4c;
		color:lightgrey;
		min-height: 30px;
		border: 1px solid #000;
		border-radius: 5px;
		min-width:50px;
		display: flex;
		 justify-content: center; /* align horizontal */
		align-items: center; /* align vertical */
		font-size:9pt;
		}
		
	#mainDiv {
		margin-top: none;
		margin-right: auto;
		margin-left: auto;
		margin-bottom: auto;
		display: flex;

		background: #1f1e1f;
		min-height: 95%;
		border: 0px solid #000;
		border-radius: 0px;
		min-width:50px;
		justify-content: center; /* align horizontal */
		align-items: top; /* align vertical */
		font-size:8pt;
		padding:20px;
		padding-right:60px;
		padding-left:60px;
		padding-top:2px;
	
		}
	
	#sendP1Score, #sendP1ScoreSub, #shotClock30, #shotClockShow, #p1extensionBtn, #p1ExtReset {
		cursor: pointer;
		min-width:85px;
		max-width:85px;
		position:absolute;
		right:50%;
		padding-left:10px;
		padding-right:10px;
		margin-right:20px;
		font-size:8pt;
		}
		
	#sendP2Score, #sendP2ScoreSub, #shotClock60, #clockLocalDisplay, #p2extensionBtn, #p2ExtReset {
		cursor: pointer;
		min-width:85px;
		max-width:85px;
		position:absolute;
		left:50%;
		padding-left:10px;
		padding-right:10px;
		margin-left:20px;
		font-size:8pt;
		}
			
	#p1colorDiv {
		
		cursor: pointer;
		min-width:75px;
		position:absolute;
		right:50%;
		padding-left:10px;
		padding-right:10px;
		background:#4c4c4c;
		color: #fff;
		border-radius:5px;
		margin-right:30px;
		font-family:tahoma;
		font-size:8pt;
		color: lightgrey;
	}
	
	#p2colorDiv {
		cursor: pointer;
		min-width:75px;
		position:absolute;
		left:50%;
		padding-left:10px;
		padding-right:10px;
		background:#4c4c4c;
		color: #fff;
		border-radius:5px;
		margin-left:30px;
		font-family:tahoma;
		font-size:8pt;
		color: lightgrey;
	}
	
	
	#stopClockDiv, #resetBtn, #sendPNames {
			cursor: pointer;
			width:253px;
			font-size:9pt;

		}
	.hover {
	}
	.hover:hover {
		background:#4f535e;
	}
	
	.noShow{
        visibility:hidden;
        }
	#clockLocalDisplay {
		color:#000;
		font-weight:bolder;
	}
	
	#footer {
	width:90%;
	left:5%;
	border: none;
	background: none;
	position: absolute;
	bottom: 5px;
	text-align:center;
	}
	#FileUpload {
    display: none;

	}
	#btnFile {
	font-size:8pt;
	background: #4c4c4c;
	color: lightgrey;
	border: none;
	padding:0px;
	cursor: pointer;


	}
	
	#settingsBox1 {
	position:relative;
	min-width:85px;
	max-width:85px;
	position:absolute;
	right:50%;
	
	padding-top:2px;
	padding-left:10px;
	padding-right:10px;
	padding-bottom:2px;
	margin-right:20px;
	
	}
	#settingsBox2 {
	position:relative;
	cursor: pointer;

	min-width:85px;
	max-width:85px;
	position:absolute;
	left:50%;
	padding-left:10px;
	padding-right:10px;
	margin-left:20px;
	}	
	
	#settingsBox3 {
	cursor: arrow;
	min-width:85px;
	max-width:85px;
	position:relative;
	left:50%;
	padding:3px;
	padding-left:10px;
	padding-right:10px;
	margin-right:109px;
	margin-bottom:3px;
	font-size:7pt;
	}	
	
	text {
	cursor: default;
	}
	
	input.smallSize {
	height: 11px;
	width: 11px;
	color:red;
	}
	
	#swapBtn {
		cursor:pointer;
		position:relative;
		border: 1px solid gold;

		padding-bottom:2px;
		width:10%;
		min-width:30px;
		min-height:15px;
		font-size:7pt;

		 
	}
	hr{
		border-top: 1px solid yellow;
		border-bottom: 0px;

	}
	
	#obsTheme {
		position:fixed;
		font-size: 8pt;
		cursor: pointer;
		background:#4c4c4c;
		border-radius:5px;
		font-family:tahoma;
		font-size:8pt;
		color: lightgrey;
		bottom:4px;
	}
	#obsThemeLabel {
		position:fixed;
		font-size: 8pt;
		font-family:tahoma;
		font-size:8pt;
		color: lightgrey;
		bottom:22px;
	}
	</style>
	</head>
	
	
    <body>
       
        <div id="mainDiv">
         <center>
	    <span>Player/Team 1 Name:</span>&nbsp;<input style="font-size:8pt; width: 120px; background:lightgrey" type="text" id="p1Name" placeholder="Player 1"><br>
        <span>Player/Team 2 Name:</span>&nbsp;<input style="font-size:8pt; width: 120px; background:lightgrey" type="text" id="p2Name" placeholder="Player 2"><br>
		<span><text style="font-size:4px">&nbsp;</text>Game and Race Info:</span>&nbsp;<input style="font-size:8pt; width: 120px; background:lightgrey" type="text" id="raceInfoTxt" placeholder=""><br>
		<span><text style="font-size:8.5px">&nbsp;&nbsp;&nbsp;</text>Wager / Other Info:&nbsp;</span><input style="font-size:8pt; width: 120px; background:lightgrey" type="text" id="wagerInfoTxt" placeholder=""><p style="font-size:5px" /p><div class="hover" id="sendPNames" onclick="postNames()">Update Info</div>
		<p style="font-size:1.5pt">&nbsp;</p>
		<select style="text-align:justify" name="p1Colors" id="p1colorDiv" onchange="playerColorChange(1)">
			<option value="" default>P1 Color</option>
            <option value="grey">Grey</option>
			<option value="steelblue">SteelBlue</option>
            <option value="cadetblue">CadetBlue</option>
			<option value="blue">Blue</option>
            <option value="tomato">Tomato</option>
			<option value="red">Red</option>
            <option value="orangered">OrangeRed</option>
            <option value="orange">Orange</option>
            <option value="khaki">Khaki</option>
            <option value="green">Green</option>
			<option value="lightgreen">lightGreen</option>
            <option value="lightseagreen">SeaGreen</option>
			<option value="purple">Purple</option>
			<option value="white">White</option>
			

        </select>
		
		<select style="text-align:justify" name="p2Colors" id="p2colorDiv" onchange="playerColorChange(2)">
            <option value="" default>P2 Color</option>
            <option value="grey">Grey</option>
			<option value="steelblue">SteelBlue</option>
            <option value="cadetblue">CadetBlue</option>
			<option value="blue">Blue</option>
            <option value="tomato">Tomato</option>
			<option value="red">Red</option>
            <option value="orangered">OrangeRed</option>
            <option value="orange">Orange</option>
            <option value="khaki">Khaki</option>
            <option value="green">Green</option>
			<option value="lightgreen">lightGreen</option>
            <option value="lightseagreen">SeaGreen</option>
			<option value="purple">Purple</option>
            <option value="white">White</option>
        </select><div class="hover" onclick="swapColors()" id="swapBtn"><text style="font-size:2pt">&nbsp;</text>Swap</div>
		<hr>
        <div class="hover" id="sendP1Score" onclick="postP1Score('add')">P1 +1 Score</div>
        <div class="hover" id="sendP2Score" onclick="postP2Score('add')">P2 +1 Score</div>
		<p style="font-size:9.25pt">&nbsp;</p>
		<div class="hover" id="sendP1ScoreSub" onclick="postP1Score('sub')">P1 -1 Score</div>
        <div class="hover" id="sendP2ScoreSub" onclick="postP2Score('sub')">P2 -1 Score</div>
		<p style="font-size:12pt">&nbsp;</p><hr>
		<div class="hover" id="shotClock30" onclick="shotClock(31000)">30s Shot Clock</div>
		<div class="hover" id="shotClock60" onclick="shotClock(61000)">60s Shot Clock</div><p style="font-size:9.25pt">&nbsp;</p>
		<div class="hover" id="shotClockShow" onclick="clockDisplay('show')">Show Clock</div>
		<div class="noShow" id="clockLocalDisplay" onclick=""></div><p style="font-size:11pt">&nbsp;</p>
		<div class="hover" id="p1extensionBtn" onclick="add30('p1')">P1 Extension</div>
		<div class="hover" id="p2extensionBtn" onclick="add30('p2')">P2 Extension</div><p style="font-size:12pt">&nbsp;</p>
		<div class="hover" id="stopClockDiv" onclick="stopClock()">Stop Clock</div>
		<HR><div class="hover" id="resetBtn" onclick="resetScore()">Reset Scores and Extensions</div><p style="font-size:1.5pt">&nbsp;</p>
		<div class="hover" id="p1ExtReset" onclick="resetExt('p1')">P1 Ext Reset</div>
		<div class="hover" id="p2ExtReset" onclick="resetExt('p2')">P2 Ext Reset</div><p style="font-size:9pt">&nbsp;</p>
		
		<div id="settingsBox1">
			<span>All <input type="checkbox" class="smallSize" id="allCheck" onchange="allCheck()" checked><br><span>Use Clock:<span> <input type="checkbox" class="smallSize" id="useClockSetting" onchange="clockSetting()" ><br><span>Salotto Logo:<span><input type="checkbox" class="smallSize" id="useSalottoSetting" onchange="salottoSetting()">
			<br><span><text id="logoName"></text>&nbsp;Logo:<span><input class="smallSize" type="checkbox" id="customLogo" onchange="customLogoSetting()">
		</div>
		<div id="settingsBox3">
		<text>Logo Image Upload<br>Max size: 2.4MB</text>
		</div><p style="font-size:1px">&nbsp;</p>
		<div id="settingsBox2">
			<input type="file" id="FileUpload" onchange="logoPost(this)" accept="image/png, image/jpeg, image/svg+xml, image/bmp" />
			<input type="button" id="btnFile" value="Upload Custom Logo" /> <br>
		
			<script type="text/javascript">
				
				document.getElementById('btnFile').onclick = function() { 
					document.getElementById('FileUpload').click();
					};
			</script>
			

		</div>	
		
		
		</center>
		<text id="obsThemeLabel">theme:</text>
		<select style="text-align:justify" name="Theme" id="obsTheme" onchange="obsThemeChange()">
            <option value="27" default>27</option>
            <option value="28">28</option>
		 </select>
	<p style="font-size:2px">&nbsp;</p><text style="font-size:7pt; color:#818181; position:fixed; top:4px; ">g4ScoreBoard v<text id="verNum"></text></text>

 		
	

	</div>
	
        <script>
			var hotkeyP1ScoreUp;
			var hotkeyP1ScoreDown;
			var hotkeyP2ScoreUp;
			var hotkeyP2ScoreDown;
			var hotkeyScoreReset;
			var hotkeyP1Extension;
			var hotkeyP2Extension;
			var hotkey30Clock;
			var hotkey60Clock;
			var hotkeyStopClock;
			var hotkeySwap;

			
			var hotkeyP1ScoreUpOld = hotkeyP1ScoreUp;
			var hotkeyP2ScoreUpOld = hotkeyP2ScoreUp;
			var hotkeyP1ScoreDownOld = hotkeyP1ScoreDown;
			var hotkeyP2ScoreDownOld = hotkeyP2ScoreDown;
			var hotkeyScoreResetOld = hotkeyScoreReset;
			var hotkeyP1ExtensionOld = hotkeyP1Extension;
			var hotkeyP2ExtensionOld = hotkeyP2Extension;
			var hotkey30ClockOld = hotkey30Clock;
			var hotkey60ClockOld = hotkey60Clock;
			var hotkeyStopClockOld = hotkeyStopClock;
			var hotkeySwapOld = hotkeySwap;
			
            const bcp1s = new BroadcastChannel('player1Score');
            const bcp2s = new BroadcastChannel('player2Score');
            const bcp1n = new BroadcastChannel('player1Name');
            const bcp2n = new BroadcastChannel('player2Name');
			const bcShotClockStart = new BroadcastChannel('shotClockStart');
			const bcClockDisplay = new BroadcastChannel('clockDisplay');
			const bcri = new BroadcastChannel('race');
			const bcw = new BroadcastChannel('wager');
			const bcp1c = new BroadcastChannel('p1_color');
			const bcp2c = new BroadcastChannel('p2_color');
			const bcr = new BroadcastChannel('recv'); // return channel from browser_source 
			
			var tev;
			//document.getElementById("swapBtn").style.left = ((window.innerWidth/2)-16);
			document.getElementById("logoName").innerHTML = cLogoName.substring(0, 6);
			document.getElementById("p1Name").value = localStorage.getItem("p1NameCtrlPanel");
			document.getElementById("p2Name").value = localStorage.getItem("p2NameCtrlPanel");
			document.getElementById("raceInfoTxt").value = localStorage.getItem("raceInfo");
			document.getElementById("wagerInfoTxt").value = localStorage.getItem("wagerInfo");
			
			postNames();
			
			document.getElementById("verNum").innerHTML = versionNum;
			
			var p1ScoreValue;
			var p2ScoreValue;
			
			if ( localStorage.getItem("useSalotto") != "yes" && localStorage.getItem("useClock") != "yes" && localStorage.getItem("useCustomLogo") != "yes" ) {
				document.getElementById("allCheck").checked = false;
				}
			
			
			
			
			
			if (localStorage.getItem('p1colorSet') !== null) {
				var cvalue = localStorage.getItem('p1colorSet');
				document.getElementById('p1colorDiv').style.background = localStorage.getItem('p1colorSet');
				document.getElementsByTagName("select")[0].options[0].value = cvalue;
				if (cvalue == "orange"  || cvalue == "khaki"  || cvalue == "tomato" || cvalue == "red" || cvalue == "white" || cvalue == "orangered" || cvalue == "orange" || cvalue == "lightgreen" || cvalue == "lightseagreen")  { document.getElementById("p1colorDiv").style.color= "#000";} else { document.getElementById("p1colorDiv").style.color= "lightgrey";};

			}
			
			if (localStorage.getItem('p2colorSet') !== null) {
				var cvalue = localStorage.getItem('p2colorSet');
				document.getElementById('p2colorDiv').style.background = localStorage.getItem('p2colorSet');
				if (cvalue == "orange"  || cvalue == "khaki"  || cvalue == "tomato" || cvalue == "red" || cvalue == "orangered" || cvalue == "white" || cvalue == "orange" || cvalue == "lightgreen" || cvalue == "lightseagreen")  { document.getElementById("p2colorDiv").style.color= "#000";} else { document.getElementById("p2colorDiv").style.color= "lightgrey";};

			}
			
			if (localStorage.getItem('p1ScoreCtrlPanel') > 0 || localStorage.getItem('p1ScoreCtrlPanel') == "" ) {
				p1ScoreValue = localStorage.getItem('p1ScoreCtrlPanel');
				bcp1s.postMessage(p1ScoreValue);
				} else {
				p1ScoreValue = 0;
				bcp1s.postMessage(p1ScoreValue);
				}
			if (localStorage.getItem('p2ScoreCtrlPanel') > 0 || localStorage.getItem('p2ScoreCtrlPanel') == "" ) {
				p2ScoreValue = localStorage.getItem('p2ScoreCtrlPanel');
				bcp2s.postMessage(p2ScoreValue);
				} else {
				p2ScoreValue = 0;
				bcp2s.postMessage(p2ScoreValue);
				}
			
			if (localStorage.getItem("useSalotto") == "yes") {
					console.log("salotto = TRUE");
					document.getElementById("useSalottoSetting").checked = true;
					salottoSetting();
						} 	else {
						salottoSetting()
						}
			
			if (localStorage.getItem("useCustomLogo") == "yes") {
					console.log("customLogo = TRUE");
					document.getElementById("customLogo").checked = true;
					customLogoSetting();
						} 	else {
						customLogoSetting()
						}			
			
			if (localStorage.getItem("useClock") == "yes") {
					console.log("Clock = TRUE");
					document.getElementById("useClockSetting").checked = true;
					clockSetting();
						} 	else {
						document.getElementById("useSalottoSetting").checked = false;
						document.getElementById("useSalottoSetting").removeAttribute("checked");
						clockSetting()
						}			
			
			
			bcr.onmessage = (event) => {
					document.getElementById("clockLocalDisplay").style.background = "lightGreen";
					document.getElementById("clockLocalDisplay").innerHTML = event.data + "s";
					tev =  event.data;
					console.log(tev);
					if (tev > 5) {
						document.getElementById("clockLocalDisplay").style.color = "black";
					}
					if (tev < 16) {
						document.getElementById("clockLocalDisplay").style.background = "yellow";
						}
					if (tev < 11) {
						document.getElementById("clockLocalDisplay").style.background = "tomato";
						}
					if (tev == 10) {
						document.getElementById("shotClockShow").setAttribute("onclick", "clockDisplay('hide')");
						document.getElementById("shotClockShow").innerHTML = "Hide Clock";

						}
                    if (tev < 6 && tev > 0) {    //tev > 0   this prevents both sounds from playing at 0.
						document.getElementById("clockLocalDisplay").style.background = "red";
						document.getElementById("clockLocalDisplay").style.color = "white";
                        warningBeep.loop = false;
                        warningBeep.play(); 
                    }
                    if (tev == 0) {
                        foulSound.loop= false;
                        foulSound.play();
						stopClock();
						}
					
			}
			

		
			function logoPost(input) {
				
				if (input.files && input.files[0]) {
				const imgPath = document.getElementById('FileUpload').files[0];
				const reader = new FileReader();
					reader.readAsDataURL(input.files[0]);
					reader.addEventListener("load", function () {
					// convert image file to base64 string and save to localStorage
					localStorage.setItem("customImage", reader.result);

					}, false);
				setTimeout(logoOther, 50);
				}
			}
			
			function logoOther() {
				bcClockDisplay.postMessage('postLogo');
			}




			function swapColors() {
				if (localStorage.getItem('p1colorSet') != null){ var p1original = localStorage.getItem('p1colorSet'); } else { var p1original = "white"; }
				if (localStorage.getItem('p2colorSet') != null){ var p2original = localStorage.getItem('p2colorSet'); } else { var p2original = "white"; }				
				setTimeout( function()  { document.getElementById("p1colorDiv").value = p2original; document.getElementById("p2colorDiv").value = p1original; bcp1c.postMessage(p2original); bcp2c.postMessage(p1original); 
				document.getElementById("p2colorDiv").style.background = p1original; document.getElementById("p1colorDiv").style.background = p2original; localStorage.setItem('p1colorSet', p2original); localStorage.setItem('p2colorSet', p1original);
				document.getElementsByTagName("select")[0].options[0].value = p2original; document.getElementsByTagName("select")[1].options[0].value = p1original;	c1value = p1original; c2value = p2original;
				if (c1value == "orange"  || c1value == "khaki"  || c1value == "tomato" || c1value == "red" || c1value == "orangered" || c1value == "white" || c1value == "orange" || c1value == "lightgreen" || c1value == "lightseagreen")  { document.getElementById("p2colorDiv").style.color= "#000";} else { document.getElementById("p2colorDiv").style.color= "lightgrey";};
				if (c2value == "orange"  || c2value == "khaki"  || c2value == "tomato" || c2value == "red" || c2value == "orangered" || c2value == "white" || c2value == "orange" || c2value == "lightgreen" || c2value == "lightseagreen")  { document.getElementById("p1colorDiv").style.color= "#000";} else { document.getElementById("p1colorDiv").style.color= "lightgrey";};
				} , 100);
			}


			function playerColorChange(player) {
			var cvalue  = document.getElementById("p"+player+"colorDiv").value;
			if (player == 1) {
				bcp1c.postMessage(document.getElementById("p"+player+"colorDiv").value);
				document.getElementById("p1colorDiv").style.background = document.getElementById("p"+player+"colorDiv").value;
				if (cvalue == "orange"  || cvalue == "khaki"  || cvalue == "tomato" || cvalue == "red" || cvalue == "orangered" || cvalue == "white" || cvalue == "orange" || cvalue == "lightgreen" || cvalue == "lightseagreen")  { document.getElementById("p1colorDiv").style.color= "#000";} else { document.getElementById("p1colorDiv").style.color= "lightgrey";};
				localStorage.setItem("p1colorSet", document.getElementById("p"+player+"colorDiv").value);
				document.getElementsByTagName("select")[0].options[0].value = cvalue;
				} else {
					bcp2c.postMessage(document.getElementById("p"+player+"colorDiv").value);
					document.getElementById("p2colorDiv").style.background = document.getElementById("p"+player+"colorDiv").value;
					if (cvalue == "orange"  || cvalue == "khaki"  || cvalue == "tomato" || cvalue == "red" || cvalue == "orangered" || cvalue == "white" || cvalue == "orange" || cvalue == "lightgreen" || cvalue == "lightseagreen")  { document.getElementById("p2colorDiv").style.color= "#000";} else { document.getElementById("p2colorDiv").style.color= "lightgrey";};
					localStorage.setItem("p2colorSet", document.getElementById("p"+player+"colorDiv").value);
					document.getElementsByTagName("select")[1].options[0].value = cvalue;
				}
			}

			function clockSetting() {
				if (!document.getElementById("useClockSetting").checked) {
						localStorage.setItem("useClock", "no");
						bcClockDisplay.postMessage("noClock");
						document.getElementById("shotClock30").classList.add("noShow");
						document.getElementById("shotClock60").classList.add("noShow");
						document.getElementById("shotClockShow").classList.add("noShow");
						document.getElementById("stopClockDiv").classList.add("noShow");
						document.getElementById("p1extensionBtn").classList.add("noShow");
						document.getElementById("p2extensionBtn").classList.add("noShow");
						document.getElementById("p1ExtReset").classList.add("noShow");
						document.getElementById("p2ExtReset").classList.add("noShow");
						document.getElementById("resetBtn").innerHTML = "Reset Scores";
						if ( localStorage.getItem("useSalotto") != "yes" && localStorage.getItem("useClock") != "yes" && localStorage.getItem("useCustomLogo") != "yes" ) {
						document.getElementById("allCheck").checked = false;
				}

					} else if (document.getElementById("useClockSetting").checked) {
						localStorage.setItem("useClock", "yes");
						bcClockDisplay.postMessage("useClock");
						document.getElementById("shotClock30").classList.remove("noShow");
						document.getElementById("shotClock60").classList.remove("noShow");
						document.getElementById("shotClockShow").classList.remove("noShow");
						document.getElementById("stopClockDiv").classList.remove("noShow");
						document.getElementById("p1extensionBtn").classList.remove("noShow");
						document.getElementById("p2extensionBtn").classList.remove("noShow");
						document.getElementById("p1ExtReset").classList.remove("noShow");
						document.getElementById("p2ExtReset").classList.remove("noShow");
						document.getElementById("resetBtn").innerHTML = "Reset Scores and Extensions";
						if ( localStorage.getItem("useSalotto") == "yes" && localStorage.getItem("useClock") == "yes" && localStorage.getItem("useCustomLogo") == "yes" ) {
						document.getElementById("allCheck").checked = true;
						}
					}
			}
	
			function clockDisplay(opt3) {
				bcClockDisplay.postMessage(opt3);
				if (opt3 == "show") {
					document.getElementById("shotClockShow").innerHTML = "Hide Clock";
					document.getElementById("shotClockShow").setAttribute("onclick", "clockDisplay('hide')");
				} else if (opt3 == "hide") {
					document.getElementById("shotClockShow").innerHTML = "Show Clock";
					document.getElementById("shotClockShow").setAttribute("onclick", "clockDisplay('show')");
				}
			}
					

            function postNames() {
				if (raceInfoTxt.value == " "){
					raceInfoTxt.value = "&nbsp;";
					}
				if (wagerInfoTxt.value == " "){
					wagerInfoTxt.value = "&nbsp;";
					}	
                bcp1n.postMessage(document.getElementById("p1Name").value.substring(0, 29));    
				bcp2n.postMessage(document.getElementById("p2Name").value.substring(0, 29));
				bcri.postMessage(document.getElementById("raceInfoTxt").value);
				bcw.postMessage(document.getElementById("wagerInfoTxt").value);
				var p1FirstName = document.getElementById("p1Name").value.split(" ")[0];
				var p2FirstName = document.getElementById("p2Name").value.split(" ")[0];
				if (!p1Name.value == "") {document.getElementById("p1ExtReset").innerHTML = "Reset<br>"+p1FirstName.substring(0, 9)+"'s Ext";} else {document.getElementById("p1ExtReset").innerHTML = "P1 Ext Reset";}
				if (!p2Name.value == "") {document.getElementById("p2ExtReset").innerHTML = "Reset<br>"+p2FirstName.substring(0, 9)+"'s Ext";} else {document.getElementById("p2ExtReset").innerHTML = "P2 Ext Reset";}
				if (!p2Name.value == "") {document.getElementById("p2extensionBtn").innerHTML = p2FirstName.substring(0, 9)+"'s<br>Extension";} else {document.getElementById("p2extensionBtn").innerHTML = "P2 Extension";}
				if (!p1Name.value == "") {document.getElementById("p1extensionBtn").innerHTML = p1FirstName.substring(0, 9)+"'s<br>Extension";} else {document.getElementById("p1extensionBtn").innerHTML = "P1 Extension";}
				localStorage.setItem("p1NameCtrlPanel", p1Name.value);
				localStorage.setItem("p2NameCtrlPanel", p2Name.value);
				localStorage.setItem("raceInfo", raceInfoTxt.value);
				localStorage.setItem("wagerInfo", wagerInfoTxt.value);

				
			}
			            
            function postP1Score(opt1) {
				if (opt1 == "add") {
					p1ScoreValue = p1ScoreValue +++ 1;
					bcp1s.postMessage(p1ScoreValue);
					localStorage.setItem("p1ScoreCtrlPanel", p1ScoreValue);
					stopClock();
					} else {
						if (p1ScoreValue > 0) {
							p1ScoreValue = p1ScoreValue --- 1;
							bcp1s.postMessage(p1ScoreValue);
							localStorage.setItem("p1ScoreCtrlPanel", p1ScoreValue);
					} 
				}
				resetExt('p1');
				resetExt('p2');
				
			}
            
			var warningBeep = new Audio("./sound/beep2.mp3");
            var foulSound = new Audio("./sound/buzz.mp3");
           
			
			function shotClock(timex) {
				bcShotClockStart.postMessage(timex);
				document.getElementById("shotClock30").setAttribute("onclick", "");
				document.getElementById("shotClock60").setAttribute("onclick", "");
				document.getElementById("shotClock30").style.color = "dimgrey";
				document.getElementById("shotClock60").style.color = "dimgrey";
				document.getElementById("stopClockDiv").style.background = "maroon";
			    document.getElementById("clockLocalDisplay").classList.remove("noShow");
						
			}
			
			function stopClock() {
				bcClockDisplay.postMessage('stopClock');
				document.getElementById("clockLocalDisplay").style.background = "lightgreen";
				document.getElementById("shotClock30").setAttribute("onclick", "shotClock(31000)");
				document.getElementById("shotClock60").setAttribute("onclick", "shotClock(61000)");
				document.getElementById("clockLocalDisplay").innerHTML = "";
				document.getElementById("clockLocalDisplay").classList.add("noShow");
				document.getElementById("shotClockShow").innerHTML = "Show Clock";
				document.getElementById("shotClockShow").setAttribute("onclick", "clockDisplay('show')");
				document.getElementById("clockLocalDisplay").style.color = "black";
				document.getElementById("shotClock30").style.color = "lightGrey";
				document.getElementById("shotClock60").style.color = "lightGrey";
				if (localStorage.getItem("obsTheme") == "28") { document.getElementById("stopClockDiv").classList.add("obs28"); } else {
				document.getElementById("stopClockDiv").style.background = "#4c4c4c"; }
			}
			
			
            function postP2Score(opt2) {
				if (opt2 == "add") {
					p2ScoreValue = p2ScoreValue +++ 1;
					bcp2s.postMessage(p2ScoreValue);
					localStorage.setItem("p2ScoreCtrlPanel", p2ScoreValue);
					stopClock();
					} else {
						if (p2ScoreValue > 0) {
							p2ScoreValue = p2ScoreValue --- 1;
							bcp2s.postMessage(p2ScoreValue);
							localStorage.setItem("p2ScoreCtrlPanel", p2ScoreValue);
							} 
				}
				resetExt('p1');
				resetExt('p2');
			}
			
			function resetScore() {
				p1ScoreValue = 0;
				p2ScoreValue = 0;
				localStorage.setItem("p1ScoreCtrlPanel", 0);
				localStorage.setItem("p2ScoreCtrlPanel", 0);
				bcp1s.postMessage(p1ScoreValue);   
				bcp2s.postMessage(p2ScoreValue);   
				resetExt('p1');
				resetExt('p2');
			}	


			function add30(player) { 
					bcClockDisplay.postMessage(player +"extension");
					document.getElementById(player+"extensionBtn").setAttribute("onclick", "");
					document.getElementById(player+"extensionBtn").style.background = "maroon";
					document.getElementById(player+"extensionBtn").style.color = "dimgrey"
					document.getElementById("shotClockShow").innerHTML = "Show Clock";
					document.getElementById("shotClockShow").setAttribute("onclick", "clockDisplay('show')");
			}

			function resetExt(player) {
				bcClockDisplay.postMessage(player +"ExtReset");
				document.getElementById(player+"extensionBtn").setAttribute("onclick", "add30('"+player+"')");
				if (localStorage.getItem("obsTheme") == "28") { document.getElementById(player+"extensionBtn").classList.add("obs28"); } else {
				document.getElementById(player+"extensionBtn").style.background = "#4c4c4c"; }
				document.getElementById(player+"extensionBtn").style.color = "lightGrey";
				
			}

			function salottoSetting() {
				if (!document.getElementById("useSalottoSetting").checked) {
				bcClockDisplay.postMessage("hidesalotto");
				localStorage.setItem("useSalotto", "no");
				if ( localStorage.getItem("useSalotto") != "yes" && localStorage.getItem("useClock") != "yes" && localStorage.getItem("useCustomLogo") != "yes" ) {	document.getElementById("allCheck").checked = false;}
				} else {
				bcClockDisplay.postMessage("showsalotto");
				localStorage.setItem("useSalotto", "yes");
				if ( localStorage.getItem("useSalotto") == "yes" && localStorage.getItem("useClock") == "yes" && localStorage.getItem("useCustomLogo") == "yes" ) {	document.getElementById("allCheck").checked = true;}
				}
			}
			
			function customLogoSetting() {
				if (!document.getElementById("customLogo").checked) {
				bcClockDisplay.postMessage("hidecustomLogo");
				localStorage.setItem("useCustomLogo", "no");
				if ( localStorage.getItem("useSalotto") != "yes" && localStorage.getItem("useClock") != "yes" && localStorage.getItem("useCustomLogo") != "yes" ) {	document.getElementById("allCheck").checked = false;}
				} else {
				bcClockDisplay.postMessage("showcustomLogo");
				localStorage.setItem("useCustomLogo", "yes");
				if ( localStorage.getItem("useSalotto") == "yes" && localStorage.getItem("useClock") == "yes" && localStorage.getItem("useCustomLogo") == "yes" ) {	document.getElementById("allCheck").checked = true;	}
				}
			}
				
			function allCheck() {
				if (!document.getElementById("allCheck").checked) {
				document.getElementById("useClockSetting").checked =  true; 
				document.getElementById("useSalottoSetting").checked =  true; 
				document.getElementById("customLogo").checked =  true; 
				document.getElementById("useClockSetting").click(); 
				document.getElementById("useSalottoSetting").click(); 
				document.getElementById("customLogo").click(); 
				} 
				else { 
				document.getElementById("useClockSetting").checked =  false; 
				document.getElementById("useSalottoSetting").checked =  false; 
				document.getElementById("customLogo").checked =  false; 
				document.getElementById("useClockSetting").click(); 
				document.getElementById("useSalottoSetting").click(); 
				document.getElementById("customLogo").click(); 
				}				
					
			}			
			

			//////////////////// HotKey scripts

			//Reload the hotjeys.js file updated by the LUA script
			function updateHotkeys() {
			    src = 'hotkeys.js';
			    $('script[src="' + src + '"]').remove();
			    var head= document.getElementsByTagName('head')[0];
		    	var script= document.createElement('script');
		    	script.src= src;
		    	head.appendChild(script);
			}

			//Toggle the switches if a hotkey is pressed
			function checkHotkeys (){
			
				if (hotkeyP1ScoreUp != hotkeyP1ScoreUpOld){
					postP1Score('add');
		            hotkeyP1ScoreUpOld = hotkeyP1ScoreUp;
				}
				if (hotkeyP2ScoreUp != hotkeyP2ScoreUpOld){
					postP2Score('add');					
					hotkeyP2ScoreUpOld = hotkeyP2ScoreUp;
				}
				if (hotkeyP1ScoreDown != hotkeyP1ScoreDownOld){
					postP1Score('sub');
		            hotkeyP1ScoreDownOld = hotkeyP1ScoreDown;
				}
				if (hotkeyP2ScoreDown != hotkeyP2ScoreDownOld){
					postP2Score('sub');
		            hotkeyP2ScoreDownOld = hotkeyP2ScoreDown;
				}
				if (hotkeyScoreReset != hotkeyScoreResetOld){
					resetScore();
		            hotkeyScoreResetOld = hotkeyScoreReset;
				}
				if (hotkeyP1Extension != hotkeyP1ExtensionOld){
					add30('p1');
		            hotkeyP1ExtensionOld = hotkeyP1Extension;
				}
				if (hotkeyP2Extension != hotkeyP2ExtensionOld){
					add30('p2');
		            hotkeyP2ExtensionOld = hotkeyP2Extension;
				}
				if (hotkey30Clock != hotkey30ClockOld){
					shotClock(31000);
					hotkey30ClockOld = hotkey30Clock;
				}
				if (hotkey60Clock != hotkey60ClockOld){
					shotClock(61000);
					hotkey60ClockOld = hotkey60Clock;
				}
				if (hotkeyStopClock != hotkeyStopClockOld){
					stopClock();
		            hotkeyStopClockOld = hotkeyStopClock;
				}
				if (hotkeySwap != hotkeySwapOld){
					swapColors();
		            hotkeySwapOld = hotkeySwap;
				}
			}
			
			function refreshData() {
			    x = 0.05; // Refresh time multiplier
				checkHotkeys();
				updateHotkeys();
				setTimeout(refreshData, x*1000);
			}
	
			refreshData();
			
			//////////////////// end of HotKey scripts
			
			
			function obsThemeChange() {
				
				if (document.getElementById("obsTheme").value ==  "28") {
					localStorage.setItem("obsTheme", "28");
					document.getElementById("mainDiv").style.background = "#2b2e38";
					document.getElementById("sendPNames").classList.add("obs28");
					document.getElementById("swapBtn").classList.add("obs28");
					document.getElementById("sendP1Score").classList.add("obs28");
					document.getElementById("sendP1ScoreSub").classList.add("obs28");
					document.getElementById("sendP2Score").classList.add("obs28");
					document.getElementById("sendP2ScoreSub").classList.add("obs28");
					document.getElementById("shotClock30").classList.add("obs28");
					document.getElementById("shotClock60").classList.add("obs28");
					document.getElementById("p1extensionBtn").classList.add("obs28");
					document.getElementById("p2extensionBtn").classList.add("obs28");
					document.getElementById("stopClockDiv").classList.add("obs28");
					document.getElementById("resetBtn").classList.add("obs28");
					document.getElementById("p1ExtReset").classList.add("obs28");
					document.getElementById("p2ExtReset").classList.add("obs28");
					document.getElementById("settingsBox1").classList.add("obs28");
					document.getElementById("settingsBox2").classList.add("obs28");
					document.getElementById("settingsBox3").classList.add("obs28");
					document.getElementById("obsThemeLabel").classList.add("obs28");
					document.getElementById("shotClockShow").classList.add("obs28");

					} else  { 
					localStorage.setItem("obsTheme",  "27");
					document.getElementById("mainDiv").style.background ="#1f1e1f"; 
					document.getElementById("sendPNames").classList.remove ("obs28");
					document.getElementById("swapBtn").classList.remove ("obs28");
					document.getElementById("sendP1Score").classList.remove ("obs28");

					document.getElementById("sendP1ScoreSub").classList.remove ("obs28");
					document.getElementById("sendP2Score").classList.remove ("obs28");
					document.getElementById("sendP2ScoreSub").classList.remove ("obs28");
					document.getElementById("shotClock30").classList.remove ("obs28");
					document.getElementById("shotClock60").classList.remove ("obs28");
					document.getElementById("p1extensionBtn").classList.remove ("obs28");
					document.getElementById("p2extensionBtn").classList.remove ("obs28");
					document.getElementById("stopClockDiv").classList.remove ("obs28");
					document.getElementById("resetBtn").classList.remove ("obs28");
					document.getElementById("p1ExtReset").classList.remove ("obs28");
					document.getElementById("p2ExtReset").classList.remove ("obs28");
					document.getElementById("settingsBox1").classList.remove ("obs28");
					document.getElementById("settingsBox2").classList.remove ("obs28");
					document.getElementById("settingsBox3").classList.remove ("obs28");
					document.getElementById("obsThemeLabel").classList.remove ("obs28");
					document.getElementById("shotClockShow").classList.remove ("obs28");

					}		
			}
			
			
			if (localStorage.getItem("obsTheme") == "28") { document.getElementById("obsTheme").value = "28"; }
			obsThemeChange();
        
		</script>
  
	</body>
</html>
